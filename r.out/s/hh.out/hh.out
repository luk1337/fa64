#!/bin/sh
### FDE.AI v4 | FeraVolt. 2019 ###
. /fde.ai/s/libfde.so;
if [ -e /sys/module/lowmemorykiller/parameters/debug_level ];then setval "0" /sys/module/lowmemorykiller/parameters/debug_level;if [ -n "$RUS" ];then flog "- Отключена отладка LMK";else flog "- LMK debugging deactivated";fi;fi;if [ "$R" -le "1024" ];then if [ -e /sys/module/lowmemorykiller/parameters/cost ];then setval "16" /sys/module/lowmemorykiller/parameters/cost;if [ -n "$RUS" ];then flog "- Оптимизирована агрессивность LMK";else flog "- LMK agressiveness optimized";fi;fi;fi;if [ -e /sys/module/lowmemorykiller/parameters/lmk_fast_run ];then setval "0" /sys/module/lowmemorykiller/parameters/lmk_fast_run;if [ -n "$RUS" ];then flog "- Отключена логика быстрой отработки LMK";else flog "- LMK fast run logic deactivated";fi;fi;if [ -e /sys/module/lowmemorykiller/parameters/enable_adaptive_lmk ];then setval "0" /sys/module/lowmemorykiller/parameters/enable_adaptive_lmk;if [ -n "$RUS" ];then flog "- Отключена логика ALMK";else flog "- ALMK deactivated";fi;fi;if [ -e /sys/module/lowmemorykiller/parameters/oom_reaper ];then setval "1" /sys/module/lowmemorykiller/parameters/oom_reaper;if [ -n "$RUS" ];then flog "- Активирована логика LMK OOM reaper";else flog "- LMK OOM reaper logic activated";fi;fi;if [ -e /sys/kernel/mm/uksm/run ];then $B echo "128">/sys/kernel/mm/uksm/pages_to_scan;$B echo "360000">/sys/kernel/mm/uksm/sleep_millisecs;$B echo "27">/sys/kernel/mm/uksm/max_cpu_percentage;$B echo "1">/sys/kernel/mm/uksm/run;$B echo "1">/sys/kernel/mm/uksm/deferred_timer;if [ -n "$RUS" ];then flog "- Активирован и оптимизирован UKSM";else flog "- UKSM activated & optimized";fi;elif [ -e /sys/kernel/mm/ksm/run ];then $B echo "128">/sys/kernel/mm/ksm/pages_to_scan;$B echo "360000">/sys/kernel/mm/ksm/sleep_millisecs;$B echo "1">/sys/kernel/mm/ksm/run;$B echo "1">/sys/kernel/mm/ksm/deferred_timer;if [ -n "$RUS" ];then flog "- Активирован и оптимизирован KSM";else flog "- KSM activated & optimized";fi;else setprop ro.config.ksm.support false;fi;if [ "$R" -le "1024" ];then $B echo "4">/proc/sys/vm/drop_caches;sync;$B sleep 0.5;$B echo "3">/proc/sys/vm/drop_caches;$B sleep 0.5;elif [ "$R" -le "2600" ];then $B echo "4">/proc/sys/vm/drop_caches;sync;$B sleep 0.5;$B echo "3">/proc/sys/vm/drop_caches;$B sleep 0.5;$B echo "1">/proc/sys/vm/drop_caches;CZR=0;else sync;CZR=0;fi;if [ -e /sys/block/ramzswap0/size ];then $B swapoff /dev/block/ramzswap0;rzscontrol /dev/block/ramzswap0 --reset;rzscontrol /dev/block/ramzswap0 -i -d $((CZR*1024));$B sleep 0.5;if [ -n "$RUS" ];then flog "- Активация ramzswap: $CZR MB";else flog "- Activating ramzswap: $CZR MB";fi;$B mkswap /dev/block/ramzswap0;$B swapon /dev/block/ramzswap0;$B sleep 0.5;$B echo "1">/sys/block/ramzswap0/queue/rq_affinity;$B echo "2">/sys/block/ramzswap0/queue/nomerges;$B echo "0">/sys/block/ramzswap0/queue/add_random;$B echo "0">/sys/block/ramzswap0/queue/rotational;$B echo "0">/sys/block/ramzswap0/queue/iostats;$B echo "64">/sys/block/ramzswap0/queue/nr_requests;$B echo "90">/proc/sys/vm/swappiness;$B sysctl -e -w vm.swappiness="90";setprop sys.vm.swappiness "90";$B echo "90">/sys/fs/cgroup/memory/sw/memory.swappiness;if [ -n "$RUS" ];then flog "- Оптимизация ramzswap";else flog "- ramzswap optimized";fi;fi;exit;
